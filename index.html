<!doctype html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>scratch-reveal â€¢ dev</title>
    <style>
      :root {
        color-scheme: dark;
      }

      * {
        box-sizing: border-box;
      }

      body {
        min-height: 100vh;
        margin: 0;
        background-color: #121212;
        font-family: "Inter", system-ui, -apple-system, sans-serif;
        display: flex;
        justify-content: center;
      }

      .page {
        text-align: center;
      }

      .scratch-wrap {
        width: min(100vw - 30px, 450px) !important;
        margin: auto;
        aspect-ratio: 1;
        overflow: hidden;
      }

      .progress-text {
        display: inline-block;
        margin-bottom: 16px;
      }
    </style>
  </head>
  <body>
    <main class="page">
      <span class="progress-text"></span>

      <div class="scratch-wrap">
        <scratch-reveal
          complete-percent="50"
          brush-size="25"
          brush-src="/demo/assets/scratch-reveal-brush.png"
          mask-src="/demo/assets/scratch-reveal-mask.webp"
          background-src="/demo/assets/scratch-reveal-background.svg"
        ></scratch-reveal>
      </div>
    </main>

    <script type="module">
      import { registerScratchRevealElement } from '/src/scratch-reveal.ts';

      registerScratchRevealElement();

      const el = document.querySelector('scratch-reveal');
      const progressText = document.querySelector('.progress-text');

      const completePercent = Number(el?.getAttribute('complete-percent') ?? 35);

      const setRemaining = (clearedPercent) => {
        if (!progressText) return;
        const remaining = Math.max(0, completePercent - clearedPercent);
        const remainingRounded = Math.round(remaining);
        progressText.textContent = `${remainingRounded}%`;
      };

      setRemaining(0);

      el.addEventListener('progress', (event) => {
        setRemaining(event.detail.percent);
      });

      el.addEventListener('complete', () => {
        setRemaining(completePercent);
        console.log('ScratchReveal: done');
      });
    </script>
  </body>
</html>
